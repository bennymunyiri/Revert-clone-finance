# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [High Issues](#high-issues)
  - [H-1: Arbitrary `from` passed to `transferFrom` (or `safeTransferFrom`)](#h-1-arbitrary-from-passed-to-transferfrom-or-safetransferfrom)
- [Medium Issues](#medium-issues)
  - [M-1: Centralization Risk for trusted owners](#m-1-centralization-risk-for-trusted-owners)
  - [M-2: Using `ERC721::_mint()` can be dangerous](#m-2-using-erc721mint-can-be-dangerous)
- [Low Issues](#low-issues)
  - [L-1: Deprecated OpenZeppelin functions should not be used](#l-1-deprecated-openzeppelin-functions-should-not-be-used)
  - [L-2: Unsafe ERC20 Operations should not be used](#l-2-unsafe-erc20-operations-should-not-be-used)
  - [L-3: Solidity pragma should be specific, not wide](#l-3-solidity-pragma-should-be-specific-not-wide)
  - [L-4: Conditional storage checks are not consistent](#l-4-conditional-storage-checks-are-not-consistent)
  - [L-5: PUSH0 is not supported by all chains](#l-5-push0-is-not-supported-by-all-chains)
- [NC Issues](#nc-issues)
  - [NC-1: Missing checks for `address(0)` when assigning values to address state variables](#nc-1-missing-checks-for-address0-when-assigning-values-to-address-state-variables)
  - [NC-2: Functions not used internally could be marked external](#nc-2-functions-not-used-internally-could-be-marked-external)
  - [NC-3: Constants should be defined and used instead of literals](#nc-3-constants-should-be-defined-and-used-instead-of-literals)
  - [NC-4: Event is missing `indexed` fields](#nc-4-event-is-missing-indexed-fields)
  - [NC-5: `require()` / `revert()` statements should have descriptive reason strings or custom errors](#nc-5-require--revert-statements-should-have-descriptive-reason-strings-or-custom-errors)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 15 |
| Total nSLOC | 4928 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| src/InterestRateModel.sol | 90 |
| src/V3Oracle.sol | 525 |
| src/V3Vault.sol | 1456 |
| src/automators/AutoExit.sol | 259 |
| src/automators/Automator.sol | 252 |
| src/interfaces/IErrors.sol | 48 |
| src/interfaces/IInterestRateModel.sol | 7 |
| src/interfaces/IV3Oracle.sol | 30 |
| src/interfaces/IVault.sol | 69 |
| src/transformers/AutoCompound.sol | 321 |
| src/transformers/AutoRange.sol | 335 |
| src/transformers/LeverageTransformer.sol | 212 |
| src/transformers/V3Utils.sol | 1054 |
| src/utils/FlashloanLiquidator.sol | 89 |
| src/utils/Swapper.sol | 181 |
| **Total** | **4928** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| Critical | 0 |
| High | 1 |
| Medium | 2 |
| Low | 5 |
| NC | 5 |


# High Issues

## H-1: Arbitrary `from` passed to `transferFrom` (or `safeTransferFrom`)

Passing an arbitrary `from` address to `transferFrom` (or `safeTransferFrom`) can lead to loss of funds, because anyone can transfer tokens from the `from` address if an approval is made.  

- Found in src/transformers/V3Utils.sol [Line: 461](src/transformers/V3Utils.sol#L461)

	```solidity
	        nonfungiblePositionManager.safeTransferFrom(
	```

- Found in src/transformers/V3Utils.sol [Line: 959](src/transformers/V3Utils.sol#L959)

	```solidity
	        nonfungiblePositionManager.safeTransferFrom(
	```



# Medium Issues

## M-1: Centralization Risk for trusted owners

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

- Found in src/InterestRateModel.sol [Line: 11](src/InterestRateModel.sol#L11)

	```solidity
	contract InterestRateModel is Ownable, IInterestRateModel, IErrors {
	```

- Found in src/InterestRateModel.sol [Line: 112](src/InterestRateModel.sol#L112)

	```solidity
	    ) public onlyOwner {
	```

- Found in src/V3Oracle.sol [Line: 24](src/V3Oracle.sol#L24)

	```solidity
	contract V3Oracle is IV3Oracle, Ownable, IErrors {
	```

- Found in src/V3Oracle.sol [Line: 236](src/V3Oracle.sol#L236)

	```solidity
	    ) external onlyOwner {
	```

- Found in src/V3Oracle.sol [Line: 260](src/V3Oracle.sol#L260)

	```solidity
	    ) external onlyOwner {
	```

- Found in src/V3Oracle.sol [Line: 335](src/V3Oracle.sol#L335)

	```solidity
	    function setEmergencyAdmin(address admin) external onlyOwner {
	```

- Found in src/V3Vault.sol [Line: 30](src/V3Vault.sol#L30)

	```solidity
	contract V3Vault is
	```

- Found in src/V3Vault.sol [Line: 1061](src/V3Vault.sol#L1061)

	```solidity
	    ) external onlyOwner {
	```

- Found in src/V3Vault.sol [Line: 1097](src/V3Vault.sol#L1097)

	```solidity
	    ) external onlyOwner {
	```

- Found in src/V3Vault.sol [Line: 1152](src/V3Vault.sol#L1152)

	```solidity
	    function setReserveFactor(uint32 _reserveFactorX32) external onlyOwner {
	```

- Found in src/V3Vault.sol [Line: 1161](src/V3Vault.sol#L1161)

	```solidity
	    ) external onlyOwner {
	```

- Found in src/V3Vault.sol [Line: 1177](src/V3Vault.sol#L1177)

	```solidity
	    ) external onlyOwner {
	```

- Found in src/V3Vault.sol [Line: 1193](src/V3Vault.sol#L1193)

	```solidity
	    function setEmergencyAdmin(address admin) external onlyOwner {
	```

- Found in src/automators/Automator.sol [Line: 20](src/automators/Automator.sol#L20)

	```solidity
	abstract contract Automator is Swapper, Ownable {
	```

- Found in src/automators/Automator.sol [Line: 65](src/automators/Automator.sol#L65)

	```solidity
	    function setWithdrawer(address _withdrawer) public onlyOwner {
	```

- Found in src/automators/Automator.sol [Line: 77](src/automators/Automator.sol#L77)

	```solidity
	    function setOperator(address _operator, bool _active) public onlyOwner {
	```

- Found in src/automators/Automator.sol [Line: 90](src/automators/Automator.sol#L90)

	```solidity
	    function setVault(address _vault, bool _active) public onlyOwner {
	```

- Found in src/automators/Automator.sol [Line: 101](src/automators/Automator.sol#L101)

	```solidity
	    ) public onlyOwner {
	```

- Found in src/transformers/AutoCompound.sol [Line: 341](src/transformers/AutoCompound.sol#L341)

	```solidity
	    function setReward(uint64 _totalRewardX64) external onlyOwner {
	```



## M-2: Using `ERC721::_mint()` can be dangerous

Using `ERC721::_mint()` can mint ERC721 tokens to addresses which don't support ERC721 tokens. Use `_safeMint()` instead of `_mint()` for ERC721.

- Found in src/V3Vault.sol [Line: 1255](src/V3Vault.sol#L1255)

	```solidity
	        _mint(receiver, shares);
	```



# Low Issues

## L-1: Deprecated OpenZeppelin functions should not be used

Openzeppelin has deprecated several functions and replaced with newer versions. Please consult https://docs.openzeppelin.com/

- Found in src/transformers/AutoCompound.sol [Line: 397](src/transformers/AutoCompound.sol#L397)

	```solidity
	            SafeERC20.safeApprove(
	```

- Found in src/transformers/AutoCompound.sol [Line: 408](src/transformers/AutoCompound.sol#L408)

	```solidity
	            SafeERC20.safeApprove(
	```

- Found in src/transformers/LeverageTransformer.sol [Line: 265](src/transformers/LeverageTransformer.sol#L265)

	```solidity
	        SafeERC20.safeApprove(IERC20(token), msg.sender, amount);
	```

- Found in src/transformers/V3Utils.sol [Line: 1124](src/transformers/V3Utils.sol#L1124)

	```solidity
	            SafeERC20.safeApprove(
	```

- Found in src/transformers/V3Utils.sol [Line: 1129](src/transformers/V3Utils.sol#L1129)

	```solidity
	            SafeERC20.safeApprove(
	```

- Found in src/transformers/V3Utils.sol [Line: 1136](src/transformers/V3Utils.sol#L1136)

	```solidity
	            SafeERC20.safeApprove(
	```

- Found in src/transformers/V3Utils.sol [Line: 1141](src/transformers/V3Utils.sol#L1141)

	```solidity
	            SafeERC20.safeApprove(
	```

- Found in src/utils/Swapper.sol [Line: 101](src/utils/Swapper.sol#L101)

	```solidity
	                SafeERC20.safeApprove(
	```

- Found in src/utils/Swapper.sol [Line: 112](src/utils/Swapper.sol#L112)

	```solidity
	                SafeERC20.safeApprove(params.tokenIn, data.allowanceTarget, 0);
	```



## L-2: Unsafe ERC20 Operations should not be used

ERC20 functions may not behave as expected. For example: return values are not always meaningful. It is recommended to use OpenZeppelin's SafeERC20 library.

- Found in src/V3Vault.sol [Line: 705](src/V3Vault.sol#L705)

	```solidity
	        nonfungiblePositionManager.approve(transformer, tokenId);
	```

- Found in src/V3Vault.sol [Line: 722](src/V3Vault.sol#L722)

	```solidity
	        nonfungiblePositionManager.approve(address(0), tokenId);
	```



## L-3: Solidity pragma should be specific, not wide

Consider using a specific version of Solidity in your contracts instead of a wide version. For example, instead of `pragma solidity ^0.8.0;`, use `pragma solidity 0.8.0;`

- Found in src/InterestRateModel.sol [Line: 2](src/InterestRateModel.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/V3Oracle.sol [Line: 2](src/V3Oracle.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/V3Vault.sol [Line: 2](src/V3Vault.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/automators/AutoExit.sol [Line: 2](src/automators/AutoExit.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/automators/Automator.sol [Line: 3](src/automators/Automator.sol#L3)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/interfaces/IErrors.sol [Line: 2](src/interfaces/IErrors.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/interfaces/IInterestRateModel.sol [Line: 3](src/interfaces/IInterestRateModel.sol#L3)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/interfaces/IV3Oracle.sol [Line: 3](src/interfaces/IV3Oracle.sol#L3)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/interfaces/IVault.sol [Line: 2](src/interfaces/IVault.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/transformers/AutoCompound.sol [Line: 2](src/transformers/AutoCompound.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/transformers/AutoRange.sol [Line: 2](src/transformers/AutoRange.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/transformers/LeverageTransformer.sol [Line: 2](src/transformers/LeverageTransformer.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/transformers/V3Utils.sol [Line: 2](src/transformers/V3Utils.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/utils/FlashloanLiquidator.sol [Line: 2](src/utils/FlashloanLiquidator.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/utils/Swapper.sol [Line: 2](src/utils/Swapper.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```



## L-4: Conditional storage checks are not consistent

When writing `require` or `if` conditionals that check storage values, it is important to be consistent to prevent off-by-one errors. There are instances found where the same storage variable is checked multiple times, but the conditionals are not consistent.

- Found in src/InterestRateModel.sol [Line: 17](src/InterestRateModel.sol#L17)

	```solidity
	    uint256 public constant MAX_MULTIPLIER_X96 = Q96 * 2; // 200%
	```

- Found in src/InterestRateModel.sol [Line: 67](src/InterestRateModel.sol#L67)

	```solidity
	        return (debt * Q96) / (cash + debt);
	```

- Found in src/InterestRateModel.sol [Line: 86](src/InterestRateModel.sol#L86)

	```solidity
	        if (utilizationRateX96 <= kinkX96) {
	```

- Found in src/InterestRateModel.sol [Line: 91](src/InterestRateModel.sol#L91)

	```solidity
	            uint256 normalRateX96 = ((kinkX96 * multiplierPerSecondX96) / Q96) +
	```

- Found in src/InterestRateModel.sol [Line: 93](src/InterestRateModel.sol#L93)

	```solidity
	            uint256 excessUtilX96 = utilizationRateX96 - kinkX96;
	```

- Found in src/InterestRateModel.sol [Line: 95](src/InterestRateModel.sol#L95)

	```solidity
	                ((excessUtilX96 * jumpMultiplierPerSecondX96) / Q96) +
	```

- Found in src/V3Oracle.sol [Line: 151](src/V3Oracle.sol#L151)

	```solidity
	            (((price0X96 * (amount0 + fees0)) /
	```

- Found in src/V3Oracle.sol [Line: 153](src/V3Oracle.sol#L153)

	```solidity
	                (price1X96 * (amount1 + fees1)) /
	```

- Found in src/V3Oracle.sol [Line: 157](src/V3Oracle.sol#L157)

	```solidity
	            (((price0X96 * fees0) / Q96 + (price1X96 * fees1) / Q96) * Q96) /
	```

- Found in src/V3Oracle.sol [Line: 271](src/V3Oracle.sol#L271)

	```solidity
	        if (token != referenceToken) {
	```

- Found in src/V3Oracle.sol [Line: 279](src/V3Oracle.sol#L279)

	```solidity
	                !((token0 == token && token1 == referenceToken) ||
	```

- Found in src/V3Oracle.sol [Line: 280](src/V3Oracle.sol#L280)

	```solidity
	                    (token0 == referenceToken && token1 == token))
	```

- Found in src/V3Oracle.sol [Line: 350](src/V3Oracle.sol#L350)

	```solidity
	        if (token == referenceToken) {
	```

- Found in src/V3Oracle.sol [Line: 376](src/V3Oracle.sol#L376)

	```solidity
	                ((10 ** referenceTokenDecimals) * chainlinkPriceX96 * Q96) /
	```

- Found in src/V3Vault.sol [Line: 44](src/V3Vault.sol#L44)

	```solidity
	    uint32 public constant MAX_COLLATERAL_FACTOR_X32 = uint32((Q32 * 90) / 100); // 90%
	```

- Found in src/V3Vault.sol [Line: 47](src/V3Vault.sol#L47)

	```solidity
	        uint32((Q32 * 2) / 100); // 2%
	```

- Found in src/V3Vault.sol [Line: 49](src/V3Vault.sol#L49)

	```solidity
	        uint32((Q32 * 10) / 100); // 10%
	```

- Found in src/V3Vault.sol [Line: 399](src/V3Vault.sol#L399)

	```solidity
	        if (value >= globalLendLimit) {
	```

- Found in src/V3Vault.sol [Line: 414](src/V3Vault.sol#L414)

	```solidity
	        if (value >= globalLendLimit) {
	```

- Found in src/V3Vault.sol [Line: 419](src/V3Vault.sol#L419)

	```solidity
	                    globalLendLimit - value,
	```

- Found in src/V3Vault.sol [Line: 610](src/V3Vault.sol#L610)

	```solidity
	        if (transformedTokenId == 0) {
	```

- Found in src/V3Vault.sol [Line: 687](src/V3Vault.sol#L687)

	```solidity
	        if (transformedTokenId > 0) {
	```

- Found in src/V3Vault.sol [Line: 740](src/V3Vault.sol#L740)

	```solidity
	        bool isTransformMode = transformedTokenId > 0 &&
	```

- Found in src/V3Vault.sol [Line: 833](src/V3Vault.sol#L833)

	```solidity
	        if (transformedTokenId > 0) {
	```

- Found in src/V3Vault.sol [Line: 936](src/V3Vault.sol#L936)

	```solidity
	        if (transformedTokenId > 0) {
	```

- Found in src/V3Vault.sol [Line: 1067](src/V3Vault.sol#L1067)

	```solidity
	        uint256 protected = (_convertToAssets(
	```

- Found in src/V3Vault.sol [Line: 1257](src/V3Vault.sol#L1257)

	```solidity
	        if (totalSupply() > globalLendLimit) {
	```

- Found in src/V3Vault.sol [Line: 1563](src/V3Vault.sol#L1563)

	```solidity
	        uint256 maxPenaltyValue = (debt * (Q32 + MAX_LIQUIDATION_PENALTY_X32)) /
	```

- Found in src/V3Vault.sol [Line: 1571](src/V3Vault.sol#L1571)

	```solidity
	            uint256 penaltyFractionX96 = (Q96 -
	```

- Found in src/V3Vault.sol [Line: 1572](src/V3Vault.sol#L1572)

	```solidity
	                (((fullValue - maxPenaltyValue) * Q96) /
	```

- Found in src/V3Vault.sol [Line: 1574](src/V3Vault.sol#L1574)

	```solidity
	            uint256 penaltyX32 = MIN_LIQUIDATION_PENALTY_X32 +
	```

- Found in src/V3Vault.sol [Line: 1575](src/V3Vault.sol#L1575)

	```solidity
	                ((MAX_LIQUIDATION_PENALTY_X32 - MIN_LIQUIDATION_PENALTY_X32) *
	```

- Found in src/V3Vault.sol [Line: 1579](src/V3Vault.sol#L1579)

	```solidity
	            liquidationValue = (debt * (Q32 + penaltyX32)) / Q32;
	```

- Found in src/V3Vault.sol [Line: 1585](src/V3Vault.sol#L1585)

	```solidity
	                (Q32 - MAX_LIQUIDATION_PENALTY_X32)) / Q32;
	```

- Found in src/V3Vault.sol [Line: 1691](src/V3Vault.sol#L1691)

	```solidity
	        supplyRateX96 = supplyRateX96.mulDiv(Q32 - reserveFactorX32, Q32);
	```

- Found in src/V3Vault.sol [Line: 1705](src/V3Vault.sol#L1705)

	```solidity
	                (oldLendExchangeRateX96 *
	```

- Found in src/V3Vault.sol [Line: 1813](src/V3Vault.sol#L1813)

	```solidity
	            ) * (Q32 + MAX_DAILY_LEND_INCREASE_X32)) / Q32;
	```

- Found in src/V3Vault.sol [Line: 1833](src/V3Vault.sol#L1833)

	```solidity
	            ) * (Q32 + MAX_DAILY_DEBT_INCREASE_X32)) / Q32;
	```

- Found in src/automators/AutoExit.sol [Line: 208](src/automators/AutoExit.sol#L208)

	```solidity
	                state.amount0 -= (state.feeAmount0 * params.rewardX64) / Q64;
	```

- Found in src/automators/AutoExit.sol [Line: 209](src/automators/AutoExit.sol#L209)

	```solidity
	                state.amount1 -= (state.feeAmount1 * params.rewardX64) / Q64;
	```

- Found in src/automators/AutoExit.sol [Line: 255](src/automators/AutoExit.sol#L255)

	```solidity
	                    state.amount0 -= (state.amount0 * params.rewardX64) / Q64;
	```

- Found in src/automators/AutoExit.sol [Line: 257](src/automators/AutoExit.sol#L257)

	```solidity
	                    state.amount1 -= (state.amount1 * params.rewardX64) / Q64;
	```

- Found in src/automators/AutoExit.sol [Line: 265](src/automators/AutoExit.sol#L265)

	```solidity
	                ((config.onlyFees ? state.feeAmount0 : state.amount0) *
	```

- Found in src/automators/AutoExit.sol [Line: 269](src/automators/AutoExit.sol#L269)

	```solidity
	                ((config.onlyFees ? state.feeAmount1 : state.amount1) *
	```

- Found in src/automators/Automator.sol [Line: 197](src/automators/Automator.sol#L197)

	```solidity
	                amountIn * (Q64 - maxPriceDifferenceX64),
	```

- Found in src/automators/Automator.sol [Line: 199](src/automators/Automator.sol#L199)

	```solidity
	                Q96 * Q64
	```

- Found in src/automators/Automator.sol [Line: 205](src/automators/Automator.sol#L205)

	```solidity
	                priceX96 * Q64
	```

- Found in src/transformers/AutoCompound.sol [Line: 64](src/transformers/AutoCompound.sol#L64)

	```solidity
	    uint64 public constant MAX_REWARD_X64 = uint64(Q64 / 50); // 2%
	```

- Found in src/transformers/AutoCompound.sol [Line: 217](src/transformers/AutoCompound.sol#L217)

	```solidity
	            state.maxAddAmount0 = (state.amount0 * Q64) / (rewardX64 + Q64);
	```

- Found in src/transformers/AutoCompound.sol [Line: 218](src/transformers/AutoCompound.sol#L218)

	```solidity
	            state.maxAddAmount1 = (state.amount1 * Q64) / (rewardX64 + Q64);
	```

- Found in src/transformers/AutoCompound.sol [Line: 240](src/transformers/AutoCompound.sol#L240)

	```solidity
	                state.amount0Fees = (state.compounded0 * rewardX64) / Q64;
	```

- Found in src/transformers/AutoCompound.sol [Line: 241](src/transformers/AutoCompound.sol#L241)

	```solidity
	                state.amount1Fees = (state.compounded1 * rewardX64) / Q64;
	```

- Found in src/transformers/AutoRange.sol [Line: 182](src/transformers/AutoRange.sol#L182)

	```solidity
	            state.protocolReward0 = (state.feeAmount0 * params.rewardX64) / Q64;
	```

- Found in src/transformers/AutoRange.sol [Line: 183](src/transformers/AutoRange.sol#L183)

	```solidity
	            state.protocolReward1 = (state.feeAmount1 * params.rewardX64) / Q64;
	```

- Found in src/transformers/AutoRange.sol [Line: 255](src/transformers/AutoRange.sol#L255)

	```solidity
	                : (state.amount0 * Q64) / (params.rewardX64 + Q64);
	```

- Found in src/transformers/AutoRange.sol [Line: 258](src/transformers/AutoRange.sol#L258)

	```solidity
	                : (state.amount1 * Q64) / (params.rewardX64 + Q64);
	```

- Found in src/transformers/AutoRange.sol [Line: 324](src/transformers/AutoRange.sol#L324)

	```solidity
	                    (state.amountAdded0 * params.rewardX64) /
	```

- Found in src/transformers/AutoRange.sol [Line: 327](src/transformers/AutoRange.sol#L327)

	```solidity
	                    (state.amountAdded1 * params.rewardX64) /
	```



## L-5: PUSH0 is not supported by all chains

Solc compiler version 0.8.20 switches the default target EVM version to Shanghai, which means that the generated bytecode will include PUSH0 opcodes. Be sure to select the appropriate EVM version in case you intend to deploy on a chain other than mainnet like L2 chains that may not support PUSH0, otherwise deployment of your contracts will fail.

- Found in src/InterestRateModel.sol [Line: 2](src/InterestRateModel.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/V3Oracle.sol [Line: 2](src/V3Oracle.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/V3Vault.sol [Line: 2](src/V3Vault.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/automators/AutoExit.sol [Line: 2](src/automators/AutoExit.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/automators/Automator.sol [Line: 3](src/automators/Automator.sol#L3)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/interfaces/IErrors.sol [Line: 2](src/interfaces/IErrors.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/interfaces/IInterestRateModel.sol [Line: 3](src/interfaces/IInterestRateModel.sol#L3)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/interfaces/IV3Oracle.sol [Line: 3](src/interfaces/IV3Oracle.sol#L3)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/interfaces/IVault.sol [Line: 2](src/interfaces/IVault.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/transformers/AutoCompound.sol [Line: 2](src/transformers/AutoCompound.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/transformers/AutoRange.sol [Line: 2](src/transformers/AutoRange.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/transformers/LeverageTransformer.sol [Line: 2](src/transformers/LeverageTransformer.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/transformers/V3Utils.sol [Line: 2](src/transformers/V3Utils.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/utils/FlashloanLiquidator.sol [Line: 2](src/utils/FlashloanLiquidator.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/utils/Swapper.sol [Line: 2](src/utils/Swapper.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```



# NC Issues

## NC-1: Missing checks for `address(0)` when assigning values to address state variables

Assigning values to address state variables without checking for `address(0)`.

- Found in src/V3Oracle.sol [Line: 336](src/V3Oracle.sol#L336)

	```solidity
	        emergencyAdmin = admin;
	```

- Found in src/V3Vault.sol [Line: 1194](src/V3Vault.sol#L1194)

	```solidity
	        emergencyAdmin = admin;
	```

- Found in src/automators/Automator.sol [Line: 67](src/automators/Automator.sol#L67)

	```solidity
	        withdrawer = _withdrawer;
	```



## NC-2: Functions not used internally could be marked external



- Found in src/InterestRateModel.sol [Line: 75](src/InterestRateModel.sol#L75)

	```solidity
	    function getRatesPerSecondX96(
	```

- Found in src/V3Vault.sol [Line: 356](src/V3Vault.sol#L356)

	```solidity
	    function decimals()
	```

- Found in src/V3Vault.sol [Line: 446](src/V3Vault.sol#L446)

	```solidity
	    function previewDeposit(
	```

- Found in src/V3Vault.sol [Line: 455](src/V3Vault.sol#L455)

	```solidity
	    function previewMint(
	```

- Found in src/V3Vault.sol [Line: 463](src/V3Vault.sol#L463)

	```solidity
	    function previewWithdraw(
	```

- Found in src/V3Vault.sol [Line: 471](src/V3Vault.sol#L471)

	```solidity
	    function previewRedeem(
	```

- Found in src/automators/Automator.sol [Line: 90](src/automators/Automator.sol#L90)

	```solidity
	    function setVault(address _vault, bool _active) public onlyOwner {
	```

- Found in src/transformers/V3Utils.sol [Line: 122](src/transformers/V3Utils.sol#L122)

	```solidity
	    function executeWithPermit(
	```



## NC-3: Constants should be defined and used instead of literals



- Found in src/V3Oracle.sol [Line: 191](src/V3Oracle.sol#L191)

	```solidity
	            ? ((priceX96 - verifyPriceX96) * 10000) / priceX96
	```

- Found in src/V3Oracle.sol [Line: 192](src/V3Oracle.sol#L192)

	```solidity
	            : ((verifyPriceX96 - priceX96) * 10000) / verifyPriceX96;
	```

- Found in src/V3Oracle.sol [Line: 376](src/V3Oracle.sol#L376)

	```solidity
	                ((10 ** referenceTokenDecimals) * chainlinkPriceX96 * Q96) /
	```

- Found in src/V3Oracle.sol [Line: 378](src/V3Oracle.sol#L378)

	```solidity
	                (10 ** feedConfig.tokenDecimals);
	```

- Found in src/V3Oracle.sol [Line: 426](src/V3Oracle.sol#L426)

	```solidity
	        return (uint256(answer) * Q96) / (10 ** feedConfig.feedDecimals);
	```

- Found in src/V3Oracle.sol [Line: 457](src/V3Oracle.sol#L457)

	```solidity
	            uint32[] memory secondsAgos = new uint32[](2);
	```

- Found in src/V3Oracle.sol [Line: 459](src/V3Oracle.sol#L459)

	```solidity
	            secondsAgos[1] = twapSeconds; // from (before)
	```

- Found in src/V3Oracle.sol [Line: 462](src/V3Oracle.sol#L462)

	```solidity
	                (tickCumulatives[0] - tickCumulatives[1]) /
	```

- Found in src/V3Vault.sol [Line: 1807](src/V3Vault.sol#L1807)

	```solidity
	        uint256 time = block.timestamp / 1 days;
	```

- Found in src/V3Vault.sol [Line: 1827](src/V3Vault.sol#L1827)

	```solidity
	        uint256 time = block.timestamp / 1 days;
	```

- Found in src/V3Vault.sol [Line: 1886](src/V3Vault.sol#L1886)

	```solidity
	        uint256 lastTokenIndex = ownedTokens[from].length - 1;
	```

- Found in src/automators/Automator.sol [Line: 233](src/automators/Automator.sol#L233)

	```solidity
	        uint32[] memory secondsAgos = new uint32[](2);
	```

- Found in src/automators/Automator.sol [Line: 236](src/automators/Automator.sol#L236)

	```solidity
	        secondsAgos[1] = twapPeriod; // from (before)
	```

- Found in src/automators/Automator.sol [Line: 245](src/automators/Automator.sol#L245)

	```solidity
	                    (tickCumulatives[0] - tickCumulatives[1]) /
	```

- Found in src/transformers/AutoRange.sol [Line: 406](src/transformers/AutoRange.sol#L406)

	```solidity
	        if (fee == 10000) {
	```

- Found in src/transformers/AutoRange.sol [Line: 407](src/transformers/AutoRange.sol#L407)

	```solidity
	            return 200;
	```

- Found in src/transformers/AutoRange.sol [Line: 408](src/transformers/AutoRange.sol#L408)

	```solidity
	        } else if (fee == 3000) {
	```

- Found in src/transformers/AutoRange.sol [Line: 409](src/transformers/AutoRange.sol#L409)

	```solidity
	            return 60;
	```

- Found in src/transformers/AutoRange.sol [Line: 410](src/transformers/AutoRange.sol#L410)

	```solidity
	        } else if (fee == 500) {
	```

- Found in src/transformers/AutoRange.sol [Line: 411](src/transformers/AutoRange.sol#L411)

	```solidity
	            return 10;
	```

- Found in src/utils/Swapper.sol [Line: 176](src/utils/Swapper.sol#L176)

	```solidity
	                        ? TickMath.MIN_SQRT_RATIO + 1
	```

- Found in src/utils/Swapper.sol [Line: 177](src/utils/Swapper.sol#L177)

	```solidity
	                        : TickMath.MAX_SQRT_RATIO - 1
	```



## NC-4: Event is missing `indexed` fields

Index event fields make the field more quickly accessible to off-chain tools that parse events. However, note that each index field costs extra gas during emission, so it's not necessarily best to index the maximum allowed per event (three fields). Each event should use three indexed fields if there are three or more fields, and gas usage is not particularly of concern for the events in question. If there are fewer than three fields, all of the fields should be indexed.

- Found in src/InterestRateModel.sol [Line: 19](src/InterestRateModel.sol#L19)

	```solidity
	    event SetValues(
	```

- Found in src/V3Oracle.sol [Line: 30](src/V3Oracle.sol#L30)

	```solidity
	    event TokenConfigUpdated(address indexed token, TokenConfig config);
	```

- Found in src/V3Oracle.sol [Line: 31](src/V3Oracle.sol#L31)

	```solidity
	    event OracleModeUpdated(address indexed token, Mode mode);
	```

- Found in src/V3Oracle.sol [Line: 32](src/V3Oracle.sol#L32)

	```solidity
	    event SetMaxPoolPriceDifference(uint16 maxPoolPriceDifference);
	```

- Found in src/V3Oracle.sol [Line: 33](src/V3Oracle.sol#L33)

	```solidity
	    event SetEmergencyAdmin(address emergencyAdmin);
	```

- Found in src/V3Vault.sol [Line: 79](src/V3Vault.sol#L79)

	```solidity
	    event ApprovedTransform(
	```

- Found in src/V3Vault.sol [Line: 86](src/V3Vault.sol#L86)

	```solidity
	    event Add(uint256 indexed tokenId, address owner, uint256 oldTokenId); // when a token is added replacing another token - oldTokenId > 0
	```

- Found in src/V3Vault.sol [Line: 87](src/V3Vault.sol#L87)

	```solidity
	    event Remove(uint256 indexed tokenId, address recipient);
	```

- Found in src/V3Vault.sol [Line: 89](src/V3Vault.sol#L89)

	```solidity
	    event ExchangeRateUpdate(
	```

- Found in src/V3Vault.sol [Line: 94](src/V3Vault.sol#L94)

	```solidity
	    event WithdrawCollateral(
	```

- Found in src/V3Vault.sol [Line: 102](src/V3Vault.sol#L102)

	```solidity
	    event Borrow(
	```

- Found in src/V3Vault.sol [Line: 108](src/V3Vault.sol#L108)

	```solidity
	    event Repay(
	```

- Found in src/V3Vault.sol [Line: 115](src/V3Vault.sol#L115)

	```solidity
	    event Liquidate(
	```

- Found in src/V3Vault.sol [Line: 128](src/V3Vault.sol#L128)

	```solidity
	    event WithdrawReserves(uint256 amount, address receiver);
	```

- Found in src/V3Vault.sol [Line: 129](src/V3Vault.sol#L129)

	```solidity
	    event SetTransformer(address transformer, bool active);
	```

- Found in src/V3Vault.sol [Line: 130](src/V3Vault.sol#L130)

	```solidity
	    event SetLimits(
	```

- Found in src/V3Vault.sol [Line: 137](src/V3Vault.sol#L137)

	```solidity
	    event SetReserveFactor(uint32 reserveFactorX32);
	```

- Found in src/V3Vault.sol [Line: 138](src/V3Vault.sol#L138)

	```solidity
	    event SetReserveProtectionFactor(uint32 reserveProtectionFactorX32);
	```

- Found in src/V3Vault.sol [Line: 139](src/V3Vault.sol#L139)

	```solidity
	    event SetTokenConfig(
	```

- Found in src/V3Vault.sol [Line: 145](src/V3Vault.sol#L145)

	```solidity
	    event SetEmergencyAdmin(address emergencyAdmin);
	```

- Found in src/automators/AutoExit.sol [Line: 12](src/automators/AutoExit.sol#L12)

	```solidity
	    event Executed(
	```

- Found in src/automators/AutoExit.sol [Line: 21](src/automators/AutoExit.sol#L21)

	```solidity
	    event PositionConfigured(
	```

- Found in src/automators/Automator.sol [Line: 28](src/automators/Automator.sol#L28)

	```solidity
	    event OperatorChanged(address newOperator, bool active);
	```

- Found in src/automators/Automator.sol [Line: 29](src/automators/Automator.sol#L29)

	```solidity
	    event VaultChanged(address newVault, bool active);
	```

- Found in src/automators/Automator.sol [Line: 31](src/automators/Automator.sol#L31)

	```solidity
	    event WithdrawerChanged(address newWithdrawer);
	```

- Found in src/automators/Automator.sol [Line: 33](src/automators/Automator.sol#L33)

	```solidity
	    event TWAPConfigChanged(uint32 TWAPSeconds, uint16 maxTWAPTickDifference);
	```

- Found in src/transformers/AutoCompound.sol [Line: 17](src/transformers/AutoCompound.sol#L17)

	```solidity
	    event AutoCompounded(
	```

- Found in src/transformers/AutoCompound.sol [Line: 29](src/transformers/AutoCompound.sol#L29)

	```solidity
	    event RewardUpdated(address account, uint64 totalRewardX64);
	```

- Found in src/transformers/AutoCompound.sol [Line: 32](src/transformers/AutoCompound.sol#L32)

	```solidity
	    event BalanceAdded(uint256 tokenId, address token, uint256 amount);
	```

- Found in src/transformers/AutoCompound.sol [Line: 33](src/transformers/AutoCompound.sol#L33)

	```solidity
	    event BalanceRemoved(uint256 tokenId, address token, uint256 amount);
	```

- Found in src/transformers/AutoCompound.sol [Line: 34](src/transformers/AutoCompound.sol#L34)

	```solidity
	    event BalanceWithdrawn(
	```

- Found in src/transformers/AutoRange.sol [Line: 14](src/transformers/AutoRange.sol#L14)

	```solidity
	    event PositionConfigured(
	```

- Found in src/transformers/V3Utils.sol [Line: 23](src/transformers/V3Utils.sol#L23)

	```solidity
	    event CompoundFees(
	```

- Found in src/transformers/V3Utils.sol [Line: 30](src/transformers/V3Utils.sol#L30)

	```solidity
	    event ChangeRange(uint256 indexed tokenId, uint256 newTokenId);
	```

- Found in src/transformers/V3Utils.sol [Line: 31](src/transformers/V3Utils.sol#L31)

	```solidity
	    event WithdrawAndCollectAndSwap(
	```

- Found in src/transformers/V3Utils.sol [Line: 36](src/transformers/V3Utils.sol#L36)

	```solidity
	    event SwapAndMint(
	```

- Found in src/transformers/V3Utils.sol [Line: 42](src/transformers/V3Utils.sol#L42)

	```solidity
	    event SwapAndIncreaseLiquidity(
	```

- Found in src/utils/Swapper.sol [Line: 18](src/utils/Swapper.sol#L18)

	```solidity
	    event Swap(
	```



## NC-5: `require()` / `revert()` statements should have descriptive reason strings or custom errors



- Found in src/utils/Swapper.sol [Line: 205](src/utils/Swapper.sol#L205)

	```solidity
	        require(amount0Delta > 0 || amount1Delta > 0); // swaps entirely within 0-liquidity regions are not supported
	```



